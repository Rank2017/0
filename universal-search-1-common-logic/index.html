<!DOCTYPE html><html><head><meta charset="utf-8"><title>Universal Search #1 Common Logic | Artifact.</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="This is the 1st article in a series that covers the steps to add searching to Ghost, Hexo or any general website using APIs provided by various services.The goal of this series is to eventually create"><meta name="keywords" content="Ghost,Hexo,Search,API"><meta property="og:type" content="article"><meta property="og:title" content="Universal Search #1 Common Logic"><meta property="og:url" content="http://artifact.me/universal-search-1-common-logic/index.html"><meta property="og:site_name" content="Artifact."><meta property="og:description" content="This is the 1st article in a series that covers the steps to add searching to Ghost, Hexo or any general website using APIs provided by various services.The goal of this series is to eventually create"><meta property="og:updated_time" content="2017-03-24T20:46:28.528Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Universal Search #1 Common Logic"><meta name="twitter:description" content="This is the 1st article in a series that covers the steps to add searching to Ghost, Hexo or any general website using APIs provided by various services.The goal of this series is to eventually create"><link rel="icon" href="/favicon.png"><script src="https://use.typekit.net/eyf3hir.js"></script><script>try{Typekit.load({async:!1})}catch(a){}</script><link rel="stylesheet" href="/icomoon/style.css"><link rel="stylesheet" href="/style.css"></head></html><body><div class="site-wrapper"><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>document.getElementById("loading-bar").style.width="20%"</script><header id="header" class="site-header clearfix"><a class="logo square clearfix" href="/"><span class="b">A</span> <span class="b">R</span> <span class="b">T</span> <span class="w">I</span> <span class="w">F</span> <span class="b">A</span> <span class="b">C</span> <span class="b">T</span> </a><a class="me square site-nav-switch clearfix"><span class="b"><span class="icon icon-menu"></span></span></a></header><script>document.getElementById("loading-bar").style.width="40%"</script><main id="main" class="clearfix"><article id="post-universal-search-1-common-logic" class="article white-box article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="article-title" itemprop="name">Universal Search #1 Common Logic</h1><div class="article-meta">Posted on <time class="article-time" datetime="2016-08-30T14:27:59.000Z" itemprop="datePublished">Aug 30, 2016</time></div></header><div class="article-entry" itemprop="articleBody"><p>This is the 1st article in a series that covers the steps to add searching to <a href="http://ghost.org" target="_blank" rel="external">Ghost</a>, <a href="http://hexo.io" target="_blank" rel="external">Hexo</a> or any general website using APIs provided by various services.</p><p>The goal of this series is to eventually create a javascript package that allows users to add searching to their websites by only copy-pasting code snippets and changing some configurations.</p><p>I name the series “universal search” because these techniques are meant to work on any website. In reality, some of them require additional plugins to be installed, some of them may only apply to a few platforms. What I am trying to do here is to provide as many options as possible so that users can find at least one solution that works.</p><h2 id="before-reading"><a href="#Before-reading" class="headerlink" title="Before reading"></a>Before reading</h2><p>The latest version of Universal Search is available on Github at <a href="https://github.com/artchen/universal-search" target="_blank" rel="external">https://github.com/artchen/universal-search</a>, feel free to clone and install.</p><p>This article discusses my design of the plugin. If you only want to use it without knowing everything behind the scene, you can go ahead to one the of the following tutorials to setup individual search services:</p><ul><li><a href="/universal-search-2-google-custom-search-engine/">Google Custom Search Engine</a></li><li><a href="/universal-search-3-hexo-local-search">Hexo Local Search</a> - Hexo only</li><li><a href="/universal-search-4-algolia-search">Algolia Search</a></li><li><a href="/universal-search-5-azure-search">Azure Search</a></li><li><a href="/universal-search-6-baidu-search">Baidu Search</a></li></ul><h2 id="basic-workflow"><a href="#Basic-Workflow" class="headerlink" title="Basic Workflow"></a>Basic Workflow</h2><ul><li>Register a 3rd-party searching service, get the credentials (API Key, ID, etc).</li><li>Send Ajax GET requests to some endpoint, get response in JSON format.</li><li>Parse the response if necessary.</li><li>Render the results on UI.</li></ul><h2 id="common-ui"><a href="#Common-UI" class="headerlink" title="Common UI"></a>Common UI</h2><p>Though I always advocate original and customized design, this time I am going to use the same common UI for some consistency. This interface is independent of whatever 3rd-party search service we choose.</p><script src="https://gist.github.com/artchen/4a961c7ac9d6b9da188868c0f29a15d4.js"></script><p>This markup will be compressed and embedded into the javascript. When the plugin is initialized, the markup will be inserted into <code>&lt;body&gt;</code>.</p><h2 id="common-logic"><a href="#Common-Logic" class="headerlink" title="Common Logic"></a>Common Logic</h2><p>The javascript part of universal search should take care of 3 main aspects:</p><ul><li>Query for search results.</li><li>Parse results.</li><li>Render UI.</li></ul><p>We already decided that the UI should be the same across services. So the following UI interactions should be defined as common functions.</p><ul><li><code>onSubmit(event)</code>: when the user submit the search form, open modal and query.</li><li><code>onNextPage()</code>: when the user request the next page, fetch next page.</li><li><code>onPrevPage()</code>: when the user request the previous page, fetch previous page.</li><li><code>close()</code>: when the user close the modal, fade out the modal.</li><li><code>uiBeforeQuery()</code>: hide the result container, show loading animation.</li><li><code>uiAfterQuery()</code>: hide loading animation, scroll result container to top, fade in the results.</li><li><code>startLoading()</code>: start the timer for loading bar animation.</li><li><code>stopLoading()</code>: stop the timer for loading bar animation.</li></ul><p>The query and parsing need to be defined on a per service basis because they apparently have different formats of API and response data. But we can centralize the following functions.</p><ul><li><code>onQueryError(queryText, status)</code>: empty result container, generate error messages and render in error container.</li><li><code>buildResult(url, title, digest)</code>: generate html for one result.</li></ul><p>Most importantly, there should be init() and destroy():</p><ul><li><code>destroy()</code>: unregister event handlers, clear markups.</li><li><code>init()</code>: register event handlers.</li></ul><p>All the functions listed above are common logics that goes into a super class called <code>SearchService</code>.</p><p>Here is the result:</p><script src="https://gist.github.com/artchen/a24102f119cf67e385db7cfa39a9c812.js"></script><p>These conclude the high level design and common part of universal search.</p><p>You can now proceed to one of the following articles to integrate the search service of your choice:</p><ul><li><a href="/universal-search-2-google-custom-search-engine/">Google Custom Search Engine</a></li><li><a href="/universal-search-3-hexo-local-search">Hexo Local Search</a> - Hexo only</li><li><a href="/universal-search-4-algolia-search">Algolia Search</a></li><li><a href="/universal-search-5-azure-search">Azure Search</a></li><li><a href="/universal-search-6-baidu-search">Baidu Search</a></li></ul></div><div class="article-tags"><a class="tag-link" href="/tags/api/">API</a><a class="tag-link" href="/tags/ghost/">Ghost</a><a class="tag-link" href="/tags/hexo/">Hexo</a><a class="tag-link" href="/tags/search/">Search</a></div><section id="comments" class="white-box"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></article><script>document.getElementById("loading-bar").style.width="60%"</script></main><footer id="footer" class="clearfix"><div class="search"><form name="searchform" id="searchform" class="u-search-form"><input type="text" id="searchinput" class="u-search-input st-default-search-input" data-list-highlight="true" data-list-value-completion="true" placeholder="Looking for something?"> <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit"><span class="icon icon-search"></span></button></form></div><div>&copy; <a href="http://artifact.me">Artifact.</a> Theme by <a href="http://artifact.me/" target="_blank">Art Chen</a>.</div><div>Powered by <a href="https://hexo.io/" rel="external">Hexo</a>.</div></footer><script>document.getElementById("loading-bar").style.width="80%"</script><div class="overlay"></div></div><div class="site-sidebar"><div class="sidebar-switch clearfix show" style="display:block"><a class="dark-btn active" data-toggle="toc"><span class="icon icon-list"></span> <span class="text">Index</span> </a><a class="dark-btn" data-toggle="bio"><span class="icon icon-person"></span> <span class="text">Bio</span></a></div><div class="site-toc show" style="display:block"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#before-reading"><span class="toc-number">1.</span> <span class="toc-text">Before reading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#basic-workflow"><span class="toc-number">2.</span> <span class="toc-text">Basic Workflow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#common-ui"><span class="toc-number">3.</span> <span class="toc-text">Common UI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#common-logic"><span class="toc-number">4.</span> <span class="toc-text">Common Logic</span></a></li></ol></div><div class="site-bio" style="display:none"><div class="about-me clearfix"><div class="avatar"><img src="/img/avatar.png"></div><div class="info"><a class="name dark-btn" href="/about">Art Chen</a></div><div class="info"><span class="item desc">A frog jumps into the pond, splash! Silence again.</span></div></div><div class="social clearfix"><a href="/atom.xml" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span> </a><a href="https://github.com/artchen" class="github" target="_blank" rel="external"><span class="icon icon-github"></span> </a><a href="https://twitter.com/otakism" class="twitter" target="_blank" rel="external"><span class="icon icon-twitter"></span> </a><a href="https://plus.google.com/+ArtChenOtakism/posts" class="google" target="_blank" rel="external"><span class="icon icon-google"></span></a></div><div class="shortcuts clearfix"><div class="bk"><a href="#header" class="dark-btn window-nav"><span class="icon icon-chevron-thin-up"></span> <span class="text">Back to Top</span></a></div><div class="bk"><a href="#footer" class="dark-btn window-nav"><span class="icon icon-chevron-thin-down"></span> <span class="text">Go to Bottom</span></a></div></div></div></div><script type="text/javascript">var GOOGLE_CUSTOM_SEARCH_API_KEY="AIzaSyBFj4A2FRz36n1bLiOQbcGhmUdpM-buAZ0",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="017821029378163458527:c46kp7iwut4",ALGOLIA_API_KEY="008d881e77dc9e73065e4635140fce5c",ALGOLIA_APP_ID="PAM0DKEGE7",ALGOLIA_INDEX_NAME="artifact.me",AZURE_SERVICE_NAME="otakism",AZURE_INDEX_NAME="artifact",AZURE_QUERY_KEY="C1398F1CAD22087764DB51A21E4C2FDE",BAIDU_API_ID="8200259220702189810",SEARCH_SERVICE="swiftype"</script><script src="https://code.jquery.com/jquery-2.1.4.min.js"></script><script>window.jQuery||document.write('<script src="/js/jquery.js"><\/script>')</script><script src="/js/search.js"></script><script src="/js/app.js"></script><script type="text/javascript">var disqus_shortname="artchen",disqus_url="http://artifact.me/universal-search-1-common-logic/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script type="text/javascript">!function(t,e,s,n,c,i,a){t.SwiftypeObject=c,t[c]=t[c]||function(){(t[c].q=t[c].q||[]).push(arguments)},i=e.createElement(s),a=e.getElementsByTagName(s)[0],i.async=1,i.src="//s.swiftypecdn.com/install/v2/st.js",a.parentNode.insertBefore(i,a)}(window,document,"script",0,"_st"),_st("install","FHMeAyBdVccJECstf-XJ","2.0.0")</script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-569722b77263e377" async></script><script>document.getElementById("loading-bar").style.width="100%"</script></body>